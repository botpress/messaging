# Configuration

## Environment variables

You can configure the server using environmnent variables. An `.env` file in the same directory as the executable can be used to load multiple environment variables.

## List of configurations

| env                       | Usage                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| NODE_ENV                  | Informs the server that it is running in `production` or `development` mode. If in `development` mode, the server will use the repo directory structure to load files (ie: .env will be loaded from `dist/.env`)                                                                                                                                                                                                              |
| PORT                      | Port used by the server. If not set, the server will try to find an unused port starting from 3100                                                                                                                                                                                                                                                                                                                            |
| EXTERNAL_URL              | External url to reach the server. This is used by channels to determine the original url of requests for validation                                                                                                                                                                                                                                                                                                           |
| INTERNAL_PASSWORD         | Internal password to add an additional security requirement to requests. When a password is set, every api request to the server must supply the internal password in their headers (`password`: `the_internal_password`). The internal password only affects the `/api` routes (channel webhooks are not affected)                                                                                                           |
| ENCRYPTION_KEY            | Encryption key used to encrypt channel configurations in the database (with aes-256). This must be a 32 byte key encoded using Base64 (encoding a 32 byte key using Base64 should result in a 44 character long string). Leaving this setting unset will disable encryption for all channel configurations. This setting cannot be changed once you have created data using this key (as the old data will become unreadable) |
| DATABASE_URL              | Connection string to the database. Can either be a connection to a PosgresSQL database (ex: `postgres://login:password@your-db-host.com:5432/your-db-name`) or a sqlite file path. If left unset, the server will create an sqlite database named `db.sqlite` in the `data` directory (or in the `dist/data` directory if in `development` mode)                                                                              |
| DATABASE_POOL             | Configuration option for connection pool (ex: `{"min":3,"max":10}`)                                                                                                                                                                                                                                                                                                                                                           |
| CLUSTER_ENABLED           | This setting determines if redis is enabled or not. The other redis settings will have no effect if this value is set to false                                                                                                                                                                                                                                                                                                |
| REDIS_URL                 | Connection string to a redis instance (ex: `redis://login:password@your-redis-host.com:6379`). If you want to configure redis for clustering, you can supply an array of connections instead (ex: `[{"host":"localhost","port":7004},{"host":"localhost","port":7001},{"host":"localhost","port":7002}]`)                                                                                                                     |
| REDIS_OPTIONS             | Advances options for redis. Refer to the [ioredis documentation](https://github.com/luin/ioredis/blob/master/API.md) (ex: `{"password":"admin123","connectTimeout":20000})`                                                                                                                                                                                                                                                   |
| REDIS_SCOPE               | Allows to prefix Redis channels and keys when multiple clients use the same Redis cluster (e.g. `development`, `production`, `server-a`)                                                                                                                                                                                                                                                                                      |
| LOGGING_ENABLED           | Toggles if incoming and outgoing messages are logged to the console. Defaults to `false` when in `production` mode and `true` when in `development` mode                                                                                                                                                                                                                                                                      |
| SUPPRESS_LOGGING          | Completely disables all logging to the console                                                                                                                                                                                                                                                                                                                                                                                |
| SYNC                      | Array of sync requests to be executed when the server starts. This can be used to configure sandboxes, or test clients                                                                                                                                                                                                                                                                                                        |
| SKIP_LOAD_ENV             | If set to `true`, the server will skip loading any config from the `.env` file                                                                                                                                                                                                                                                                                                                                                |
| NO_LOGO                   | Toggles the Messaging Server logo when starting the server                                                                                                                                                                                                                                                                                                                                                                    |
| BATCHING_ENABLED          | Toggles batching for inserts in the database (experimental)                                                                                                                                                                                                                                                                                                                                                                   |
| SINGLE_LINE_LOGGING       | Display logs in a single line. (useful for log aggregation)                                                                                                                                                                                                                                                                                                                                                                   |
| DISABLE_LOGGING_TIMESTAMP | Disable the display of timestamp in the logs.                                                                                                                                                                                                                                                                                                                                                                                 |

## Example `.env` file

```
NODE_ENV=production
PORT=3000
EXTERNAL_URL=https://my-hosted-messaging.com
DATABASE_URL=postgres://user:password@localhost:5432/mydbname
DATABASE_POOL={"min":3,"max":10}
INTERNAL_PASSWORD=my-super-secret-internal-password123*
ENCRYPTION_KEY=this+is+a+test+key+ruwy1UMdKwlwo8n412wCek2w=
CLUSTER_ENABLED=true
REDIS_URL=redis://user:password@localhost:6379
REDIS_OPTIONS={"connectTimeout":20000}
REDIS_SCOPE=production
LOGGING_ENABLED=false
SYNC=[{"name":"sandbox","sandbox":true,"channels":{"telegram":{"enabled":true,"botToken":"my-bot-token"}}},{"id":"96af5294-46f1-4a85-a17f-6863fa4d77d7","token":"test-token-123","name":"test","channels":{"twilio":{"enabled":true,"accountSID":"my-account-sid","authToken":"my-auth-token"},"telegram":{"enabled":true,"botToken":"my-bot-token"}},"webhooks":[]}]
```
